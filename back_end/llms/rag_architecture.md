# RAG系统架构图

## 系统组件交互图

```
                                     +------------------+
                                     |                  |
                                     |     前端界面     |
                                     |                  |
                                     +--------+---------+
                                              |
                                              | HTTP 请求/响应
                                              |
+------------------+    +---------------+-----v-----+---------------+
|                  |    |               |           |               |
|   文档管理子系统  <---->  create_role  |  query   |  delete_role  |
|                  |    |    add_files  |           |               |
+--------+---------+    +---------------+-----------+---------------+
         |                              ^
         | 处理文档                      | API 调用
         v                              |
+--------+---------+               +----+----+
|                  |               |         |
|  文档分割与向量化  |               |  Role类 |
|                  |               |         |
+--------+---------+               +----+----+
         |                              ^
         | 存储向量                      | 调用
         v                              |
+--------+---------+    +---------------+-----------------+
|                  |    |               |                 |
|  FAISS向量数据库  <---->  检索相关文档  |   生成回答       |
|                  |    |               |                 |
+------------------+    +---------------+-----------------+
                                  ^            ^
                                  |            |
                                  |            |
                        +---------+----+   +---+--------+
                        |              |   |            |
                        | Embedding模型|   |   LLM模型   |
                        |              |   |            |
                        +--------------+   +------------+
```

## 数据流向图

```
  +-------------+     +-------------+     +-------------+     +-------------+
  |             |     |             |     |             |     |             |
  |  文档上传   +---->+  文档处理   +---->+  向量存储   +---->+  知识库构建  |
  |             |     |             |     |             |     |             |
  +-------------+     +-------------+     +-------------+     +------+------+
                                                                     |
                                                                     |
                                                                     v
  +-------------+     +-------------+     +-------------+     +------+------+
  |             |     |             |     |             |     |             |
  |  返回回答   <-----+  生成回答   <-----+  提示词构建  <-----+  用户提问   |
  |             |     |             |     |             |     |             |
  +-------------+     +-------------+     +-------------+     +-------------+
```

## 角色管理流程

```
  +-------------+     +-------------+     +-------------+
  |             |     |             |     |             |
  |  创建角色   +---->+  确定路径   +---->+  生成数据库  |
  |             |     |             |     |             |
  +------+------+     +-------------+     +------+------+
         |                                       |
         |                                       |
         v                                       v
  +------+------+     +-------------+     +------+------+
  |             |     |             |     |             |
  |  上传文档   +---->+ 文档预处理  +---->+  向量化存储  |
  |             |     |             |     |             |
  +-------------+     +-------------+     +------+------+
                                                 |
                                                 |
                                                 v
  +-------------+     +-------------+     +------+------+
  |             |     |             |     |             |
  |  返回结果   <-----+  生成回答   <-----+  检索文档片段 |
  |             |     |             |     |             |
  +-------------+     +-------------+     +-------------+
```

## 文件处理流程

```
  +-------------+     +---------------+     +---------------+
  |             |     |               |     |               |
  |  原始文档   +---->+  文本清理     +---->+  文本分割     |
  |             |     |  (清除空行等) |     |  (按词/句分段) |
  +-------------+     +---------------+     +-------+-------+
                                                    |
                                                    |
                                                    v
  +-------------+     +---------------+     +-------+-------+
  |             |     |               |     |               |
  |  存储向量   <-----+  生成嵌入向量  <-----+  处理段落重叠 |
  |             |     |               |     |               |
  +-------------+     +---------------+     +---------------+
``` 