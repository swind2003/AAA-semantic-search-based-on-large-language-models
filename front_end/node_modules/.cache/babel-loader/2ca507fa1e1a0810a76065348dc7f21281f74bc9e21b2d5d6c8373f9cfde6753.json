{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport axios from 'axios';\nexport default {\n  name: 'ChangeRole',\n  data() {\n    return {\n      role_log: [],\n      user_id: this.$route.query.user_id,\n      text: '的海外的合法大大覅哈哈爱上的人发放时aaa',\n      pictures: [],\n      // 头像\n      role_id: [],\n      file: null,\n      // 上传的AI资料\n      selectedFile: null,\n      // 用于存储用户选择的文件\n      file_get: '',\n      // 上传的AI资料\n      file_show: '',\n      // 上传的资料名称显示\n      loading: false,\n      loginname: ''\n    };\n  },\n  created() {\n    this.getInfo();\n  },\n  mounted() {\n    this.loginname = this.cookie.getCookie('LoginName');\n  },\n  methods: {\n    async exit() {\n      const res = await axios.post('http://119.39.26.149:5000/login_system/log_out', {\n        user_id: this.user_id\n      });\n      console.log(res);\n      this.$router.push('/login_system');\n    },\n    selectAndUploadFile(index) {\n      // 触发文件选择\n      this.$refs['fileInput_' + index][0].click();\n      console.log(\"haha\");\n    },\n    handleFileUpload(index, roleId) {\n      // 处理文件选择事件\n      const file = this.$refs['fileInput_' + index][0].files[0];\n\n      // 检查文件类型是否为 .txt\n      if (file && file.type === 'text/plain') {\n        // 执行文件上传操作，可以调用你之前的上传逻辑\n        this.uploadFile(file, roleId);\n        this.$refs['fileInput_' + index][0].value = '';\n        // this.loading = true\n      } else {\n        // 如果不是 .txt 文件，清空选择的文件或者进行其他处理\n        this.$message({\n          message: '请选择一个 .txt 文件',\n          type: 'warning'\n        });\n      }\n    },\n    async uploadFile(file, roleId) {\n      // 执行文件上传的逻辑，可以使用 XMLHttpRequest 或其他上传方式\n      // 请根据你的实际需求进行实现\n      let files = new FormData();\n      files.append('files', file);\n      files.append('role_id', roleId);\n      this.loading = true;\n      const res = await axios.post('http://119.39.26.149:5000//builtin_role_administrator/add_role_store', files);\n      this.loading = false;\n      if (res.data.code === '200') {\n        this.$message({\n          message: '上传成功！',\n          type: 'success'\n        });\n      } else if (res.data.code === '400' || res.data.code === '401') {\n        this.$message.error('上传失败！');\n      }\n    },\n    formatText(text) {\n      if (text.length > 18) {\n        return `${text.slice(0, 18)}...`;\n      }\n      return text;\n    },\n    async getInfo() {\n      const res1 = await axios.get('http://119.39.26.149:5000/builtin_role_administrator/information/get_role_information', {\n        params: {\n          user_id: \"000000\"\n        }\n      });\n      // console.log(this.user_id);\n      // console.log(res1);\n      this.role_log = res1.data.data;\n      console.log(this.role_log);\n      this.getPictures(this.role_log);\n    },\n    async getPictures(role_log) {\n      this.pictures = [];\n      let length = role_log.length;\n      for (let i = 0; i < length; i++) {\n        const res = await axios.get('http://119.39.26.149:5000/builtin_role_administrator/information/get_role_head_portrait', {\n          params: {\n            role_id: role_log[i].role_id,\n            user_id: \"000000\"\n          },\n          responseType: 'blob'\n        });\n        if (res.data.code === '400') {\n          this.$message.error('获取头像失败！');\n        }\n        const imgUrl = URL.createObjectURL(res.data);\n        this.pictures.push(imgUrl);\n      }\n    },\n    async modifyRole(roleId) {\n      this.$router.push({\n        path: '/ModifyRole',\n        query: {\n          user_id: \"000000\",\n          role_id: roleId\n        }\n      });\n    },\n    async sendAPI(value) {\n      const res = await axios.get('http://119.39.26.149:5000//builtin_role_administrator/information/write_openai_api_key', {\n        params: {\n          openai_api_key: value\n        }\n      });\n      if (res.data.code === '200') {\n        this.$message({\n          message: '上传成功！',\n          type: 'success'\n        });\n      } else if (res.data.code === '400') {\n        this.$message.error('上传失败！');\n      }\n      console.log(res);\n    },\n    open() {\n      this.$prompt('请输入API密钥', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        inputPattern: /^sk-[a-zA-Z0-9]+$/,\n        inputErrorMessage: 'API密钥格式不正确'\n      }).then(({\n        value\n      }) => {\n        this.$message({\n          type: 'success',\n          message: '你的API密钥是: ' + value\n        });\n        this.sendAPI(value);\n      }).catch(() => {\n        this.$message({\n          type: 'info',\n          message: '取消输入'\n        });\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","name","data","role_log","user_id","$route","query","text","pictures","role_id","file","selectedFile","file_get","file_show","loading","loginname","created","getInfo","mounted","cookie","getCookie","methods","exit","res","post","console","log","$router","push","selectAndUploadFile","index","$refs","click","handleFileUpload","roleId","files","type","uploadFile","value","$message","message","FormData","append","code","error","formatText","length","slice","res1","get","params","getPictures","i","responseType","imgUrl","URL","createObjectURL","modifyRole","path","sendAPI","openai_api_key","open","$prompt","confirmButtonText","cancelButtonText","inputPattern","inputErrorMessage","then","catch"],"sources":["src/views/ChangeRole.vue"],"sourcesContent":["<template>\r\n  <div class=\"wrapped-cr\"  v-loading=\"loading\" element-loading-text=\"上传资料中\" element-loading-spinner=\"el-icon-loading\" element-loading-background=\"rgba(0, 0, 0, 0.8)\">\r\n    <div class=\"left\">\r\n      <ul class=\"leftText\">\r\n        <li><h2>当前登录人：{{loginname}}</h2></li>\r\n        <li class=\"one\">修改角色</li>\r\n        <li class=\"two\" @click='toCreateInnerRoles()'>新增角色</li>\r\n        <li class=\"three\" @click=\"exit()\">退出登录</li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"right\">\r\n      <div class=\"top-cr\">\r\n        <h2>修改角色</h2>\r\n         <el-button type=\"text\" @click=\"open\" class='changeKey'>修改API密钥</el-button>\r\n      </div>\r\n      <div class=\"roleTable\">\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th style=\"width: 320px;\">头像</th>\r\n              <th style=\"width: 320px;\">名称</th>\r\n              <th style=\"width: 320px;\">描述</th>\r\n              <th style=\"width: 400px;\">操作</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr v-for=\"(item, index1) in role_log\" :key=\"index1\">\r\n               <td v-for=\"(picture, index2) in pictures\" :key=\"index2\" v-show=\"index1 === index2\" class=\"imgWrapped\">\r\n                <img :src=\"picture\" alt=\"\">\r\n              </td>\r\n              <td>{{item.role_name}}</td>\r\n              <td>{{formatText(item.description) }}</td>\r\n              <td><button class='change' @click=\"modifyRole(item.role_id)\">修改角色</button>\r\n              <input type=\"file\" :ref=\"'fileInput_' + index1\" style=\"display: none\" @change=\"handleFileUpload(index1, item.role_id)\" accept=\".txt\">\r\n              <button class='uoload' @click=\"selectAndUploadFile(index1)\" :disabled=\"!item.have_document_store\" :class=\"{ 'disabled-button': !item.have_document_store }\">上传资料</button>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n\r\n        </table>  \r\n               \r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios'\r\nexport default {\r\n  name: 'ChangeRole',\r\n  data() {\r\n        return {\r\n          role_log: [],\r\n          user_id: this.$route.query.user_id,\r\n          text: '的海外的合法大大覅哈哈爱上的人发放时aaa',\r\n          pictures: [], // 头像\r\n          role_id: [],\r\n          file: null, // 上传的AI资料\r\n          selectedFile: null, // 用于存储用户选择的文件\r\n          file_get: '', // 上传的AI资料\r\n          file_show: '', // 上传的资料名称显示\r\n          loading: false,\r\n          loginname: ''\r\n\r\n        }\r\n      },\r\n  \r\n   created () {\r\n    this.getInfo()\r\n  },\r\n\r\n  mounted () {\r\n    this.loginname = this.cookie.getCookie('LoginName')\r\n  },\r\n   methods: {\r\n\r\n    async exit () {\r\n      const res = await axios.post('http://119.39.26.149:5000/login_system/log_out', {\r\n        user_id: this.user_id\r\n      })\r\n      console.log(res)\r\n      this.$router.push('/login_system')\r\n    },\r\n    selectAndUploadFile(index) {\r\n    // 触发文件选择\r\n    this.$refs['fileInput_' + index][0].click();\r\n    console.log(\"haha\")\r\n  },\r\n\r\n  handleFileUpload(index, roleId) {\r\n    // 处理文件选择事件\r\n    const file = this.$refs['fileInput_' + index][0].files[0];\r\n\r\n\r\n    // 检查文件类型是否为 .txt\r\n    if (file && file.type === 'text/plain') {\r\n    // 执行文件上传操作，可以调用你之前的上传逻辑\r\n    this.uploadFile(file, roleId);\r\n    this.$refs['fileInput_' + index][0].value = '';\r\n    // this.loading = true\r\n    } else {\r\n    // 如果不是 .txt 文件，清空选择的文件或者进行其他处理\r\n    this.$message({\r\n          message: '请选择一个 .txt 文件',\r\n          type: 'warning'\r\n        });\r\n    }\r\n  },\r\n   \r\n   async uploadFile(file, roleId) {\r\n    // 执行文件上传的逻辑，可以使用 XMLHttpRequest 或其他上传方式\r\n    // 请根据你的实际需求进行实现\r\n    let files = new FormData()\r\n    files.append('files', file)\r\n    files.append('role_id', roleId)\r\n    this.loading = true\r\n    const res = await axios.post('http://119.39.26.149:5000//builtin_role_administrator/add_role_store', files) \r\n    this.loading = false\r\n    if (res.data.code === '200') {\r\n      this.$message({\r\n          message: '上传成功！',\r\n          type: 'success'\r\n        });\r\n    } else if (res.data.code === '400' || res.data.code === '401') {\r\n      this.$message.error('上传失败！');\r\n    }\r\n  },\r\n\r\n  \r\n    formatText(text) {\r\n    if (text.length > 18) {\r\n    return `${text.slice(0, 18)}...`;\r\n    }\r\n    return text;\r\n  },\r\n    async getInfo () {\r\n      const res1 = await axios.get('http://119.39.26.149:5000/builtin_role_administrator/information/get_role_information', {\r\n        params: {\r\n          user_id: \"000000\"\r\n        }\r\n      })\r\n      // console.log(this.user_id);\r\n      // console.log(res1);\r\n      this.role_log = res1.data.data\r\n      console.log(this.role_log);\r\n      this.getPictures(this.role_log)\r\n  },\r\n\r\n  async getPictures (role_log) {\r\n      this.pictures = []\r\n      let length = role_log.length\r\n      for (let i = 0 ; i < length; i++) {\r\n        const res = await axios.get('http://119.39.26.149:5000/builtin_role_administrator/information/get_role_head_portrait', {\r\n          params: {\r\n            role_id: role_log[i].role_id,\r\n            user_id: \"000000\"\r\n          },\r\n          responseType: 'blob'\r\n        })\r\n        if (res.data.code === '400' ) {\r\n      this.$message.error('获取头像失败！');\r\n        }\r\n        const imgUrl = URL.createObjectURL(res.data)\r\n        this.pictures.push(imgUrl)\r\n      }\r\n    },\r\n\r\n    async modifyRole (roleId) {\r\n    this.$router.push({\r\n        path: '/ModifyRole',\r\n        query: {\r\n              user_id: \"000000\",\r\n              role_id: roleId,\r\n            }\r\n      })\r\n    },\r\n\r\n    async sendAPI (value) {\r\n      const res = await axios.get('http://119.39.26.149:5000//builtin_role_administrator/information/write_openai_api_key', {\r\n          params: {\r\n            openai_api_key: value,\r\n          },\r\n        })\r\n\r\n        if (res.data.code === '200') {\r\n      this.$message({\r\n          message: '上传成功！',\r\n          type: 'success'\r\n        });\r\n    } else if (res.data.code === '400') {\r\n      this.$message.error('上传失败！');\r\n    }\r\n      console.log(res);\r\n    },\r\n\r\n     open() {\r\n        this.$prompt('请输入API密钥', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          inputPattern: /^sk-[a-zA-Z0-9]+$/,\r\n          inputErrorMessage: 'API密钥格式不正确'\r\n        }).then(({ value }) => {\r\n            this.$message({\r\n            type: 'success',\r\n            message: '你的API密钥是: ' + value\r\n          });\r\n          this.sendAPI (value)\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '取消输入'\r\n          });       \r\n        });\r\n      }\r\n              \r\n}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.wrapped-cr {\r\n    display: flex;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background-color: #465069;\r\n    opacity: 0.9;\r\n  }\r\n\r\n\r\n  .left {\r\n    width: 90px;\r\n    /* height: 705px; */\r\n    height: 100%;\r\n    background-color: #D6ECFF;\r\n    border-radius: 10px 0 0 10px;\r\n  }\r\n\r\n  .leftText {\r\n    position: relative;\r\n    color: #9CBFFB;\r\n    font-weight: 700;\r\n    font-size: 18px;\r\n    text-align: center;\r\n  }\r\n\r\n  .leftText li {\r\n    width: 90px;\r\n    height: 50px;\r\n    line-height: 50px;\r\n    border: 2px solid #9CBFFB;\r\n    border-radius: 10px;\r\n  }\r\n\r\n  .leftText li:hover {\r\n    background-color: #a0bff5;\r\n    color: #1990FF;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .leftText .one {\r\n    position: absolute;\r\n    top: 90px;\r\n    color: #1990FF;\r\n  }\r\n\r\n  .leftText .two {\r\n    position: absolute;\r\n    top: 250px;\r\n    color: #9CBFFB;\r\n  }\r\n\r\n  .leftText .three {\r\n    position: absolute;\r\n    top: 420px;\r\n  }\r\n\r\n  .right {\r\n    width: 1445px;\r\n    background-color: #f2f5f8;\r\n  }\r\n\r\n\r\n\r\n  .top-cr {\r\n    /* display: flex; */\r\n    width: 100%;\r\n    height: 80px;\r\n    border: 1px solid #d3d4d6;\r\n  }\r\n\r\n  .top-cr h2 {\r\n    margin-left:600px;\r\n    display: inline-block;\r\n    /* text-align: center; */\r\n    line-height: 80px;\r\n  }\r\n\r\n  .top-cr .changeKey {\r\n    margin-left: 500px;\r\n  }\r\n\r\n\r\n\r\n \r\n  .roleTable {\r\n    margin-left: 20px;\r\n    max-height: 505px; \r\n    overflow-y: auto;\r\n  }\r\n  .roleTable table {\r\n    border-collapse: collapse;\r\n  }\r\n  \r\n  .roleTable th {\r\n    position: sticky;\r\n    top: 0;\r\n    background-color: #f2f2f2;\r\n    z-index: 1;\r\n  }\r\n\r\n  .roleTable th, td {\r\n    text-align: center;\r\n    width: 330px;\r\n    height: 50px;\r\n    border: 1px solid #BBBBBB;\r\n  }\r\n  \r\n   .roleTable .imgWrapped img {\r\n   /* position: absolute; */\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 50%;\r\n  }\r\n  \r\n  .roleTable .upload {\r\n     width: 90px;\r\n    height: 30px;\r\n    background-color: #9CBFFB;\r\n    margin-right: 30px;\r\n    border: none;\r\n  }\r\n  \r\n  .roleTable .change {\r\n    width: 90px;\r\n    height: 30px;\r\n    color: white;\r\n    background-color: #409eff;\r\n    border: none;\r\n  }\r\n\r\n  .roleTable .uoload {\r\n    margin-left: 20px;\r\n    width: 90px;\r\n    height: 30px;\r\n    color: white;\r\n    background-color: #67c23a;\r\n    border: none;\r\n  }\r\n  \r\n  .roleTable button:hover {\r\n    opacity: 0.7;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .disabled-button {\r\n    margin-left: 20px;\r\n    width: 90px;\r\n    height: 30px;\r\n    color: white;\r\n    background-color: #67c23a;\r\n    border: none;\r\n    opacity: 0.3;\r\n    pointer-events: none; /* 禁用按钮的交互 */\r\n  }\r\n  \r\n\r\n</style>"],"mappings":";;;;AA+CA,OAAAA,KAAA;AACA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,QAAA;MACAC,OAAA,OAAAC,MAAA,CAAAC,KAAA,CAAAF,OAAA;MACAG,IAAA;MACAC,QAAA;MAAA;MACAC,OAAA;MACAC,IAAA;MAAA;MACAC,YAAA;MAAA;MACAC,QAAA;MAAA;MACAC,SAAA;MAAA;MACAC,OAAA;MACAC,SAAA;IAEA;EACA;EAEAC,QAAA;IACA,KAAAC,OAAA;EACA;EAEAC,QAAA;IACA,KAAAH,SAAA,QAAAI,MAAA,CAAAC,SAAA;EACA;EACAC,OAAA;IAEA,MAAAC,KAAA;MACA,MAAAC,GAAA,SAAAvB,KAAA,CAAAwB,IAAA;QACApB,OAAA,OAAAA;MACA;MACAqB,OAAA,CAAAC,GAAA,CAAAH,GAAA;MACA,KAAAI,OAAA,CAAAC,IAAA;IACA;IACAC,oBAAAC,KAAA;MACA;MACA,KAAAC,KAAA,gBAAAD,KAAA,KAAAE,KAAA;MACAP,OAAA,CAAAC,GAAA;IACA;IAEAO,iBAAAH,KAAA,EAAAI,MAAA;MACA;MACA,MAAAxB,IAAA,QAAAqB,KAAA,gBAAAD,KAAA,KAAAK,KAAA;;MAGA;MACA,IAAAzB,IAAA,IAAAA,IAAA,CAAA0B,IAAA;QACA;QACA,KAAAC,UAAA,CAAA3B,IAAA,EAAAwB,MAAA;QACA,KAAAH,KAAA,gBAAAD,KAAA,KAAAQ,KAAA;QACA;MACA;QACA;QACA,KAAAC,QAAA;UACAC,OAAA;UACAJ,IAAA;QACA;MACA;IACA;IAEA,MAAAC,WAAA3B,IAAA,EAAAwB,MAAA;MACA;MACA;MACA,IAAAC,KAAA,OAAAM,QAAA;MACAN,KAAA,CAAAO,MAAA,UAAAhC,IAAA;MACAyB,KAAA,CAAAO,MAAA,YAAAR,MAAA;MACA,KAAApB,OAAA;MACA,MAAAS,GAAA,SAAAvB,KAAA,CAAAwB,IAAA,yEAAAW,KAAA;MACA,KAAArB,OAAA;MACA,IAAAS,GAAA,CAAArB,IAAA,CAAAyC,IAAA;QACA,KAAAJ,QAAA;UACAC,OAAA;UACAJ,IAAA;QACA;MACA,WAAAb,GAAA,CAAArB,IAAA,CAAAyC,IAAA,cAAApB,GAAA,CAAArB,IAAA,CAAAyC,IAAA;QACA,KAAAJ,QAAA,CAAAK,KAAA;MACA;IACA;IAGAC,WAAAtC,IAAA;MACA,IAAAA,IAAA,CAAAuC,MAAA;QACA,UAAAvC,IAAA,CAAAwC,KAAA;MACA;MACA,OAAAxC,IAAA;IACA;IACA,MAAAU,QAAA;MACA,MAAA+B,IAAA,SAAAhD,KAAA,CAAAiD,GAAA;QACAC,MAAA;UACA9C,OAAA;QACA;MACA;MACA;MACA;MACA,KAAAD,QAAA,GAAA6C,IAAA,CAAA9C,IAAA,CAAAA,IAAA;MACAuB,OAAA,CAAAC,GAAA,MAAAvB,QAAA;MACA,KAAAgD,WAAA,MAAAhD,QAAA;IACA;IAEA,MAAAgD,YAAAhD,QAAA;MACA,KAAAK,QAAA;MACA,IAAAsC,MAAA,GAAA3C,QAAA,CAAA2C,MAAA;MACA,SAAAM,CAAA,MAAAA,CAAA,GAAAN,MAAA,EAAAM,CAAA;QACA,MAAA7B,GAAA,SAAAvB,KAAA,CAAAiD,GAAA;UACAC,MAAA;YACAzC,OAAA,EAAAN,QAAA,CAAAiD,CAAA,EAAA3C,OAAA;YACAL,OAAA;UACA;UACAiD,YAAA;QACA;QACA,IAAA9B,GAAA,CAAArB,IAAA,CAAAyC,IAAA;UACA,KAAAJ,QAAA,CAAAK,KAAA;QACA;QACA,MAAAU,MAAA,GAAAC,GAAA,CAAAC,eAAA,CAAAjC,GAAA,CAAArB,IAAA;QACA,KAAAM,QAAA,CAAAoB,IAAA,CAAA0B,MAAA;MACA;IACA;IAEA,MAAAG,WAAAvB,MAAA;MACA,KAAAP,OAAA,CAAAC,IAAA;QACA8B,IAAA;QACApD,KAAA;UACAF,OAAA;UACAK,OAAA,EAAAyB;QACA;MACA;IACA;IAEA,MAAAyB,QAAArB,KAAA;MACA,MAAAf,GAAA,SAAAvB,KAAA,CAAAiD,GAAA;QACAC,MAAA;UACAU,cAAA,EAAAtB;QACA;MACA;MAEA,IAAAf,GAAA,CAAArB,IAAA,CAAAyC,IAAA;QACA,KAAAJ,QAAA;UACAC,OAAA;UACAJ,IAAA;QACA;MACA,WAAAb,GAAA,CAAArB,IAAA,CAAAyC,IAAA;QACA,KAAAJ,QAAA,CAAAK,KAAA;MACA;MACAnB,OAAA,CAAAC,GAAA,CAAAH,GAAA;IACA;IAEAsC,KAAA;MACA,KAAAC,OAAA;QACAC,iBAAA;QACAC,gBAAA;QACAC,YAAA;QACAC,iBAAA;MACA,GAAAC,IAAA;QAAA7B;MAAA;QACA,KAAAC,QAAA;UACAH,IAAA;UACAI,OAAA,iBAAAF;QACA;QACA,KAAAqB,OAAA,CAAArB,KAAA;MACA,GAAA8B,KAAA;QACA,KAAA7B,QAAA;UACAH,IAAA;UACAI,OAAA;QACA;MACA;IACA;EAEA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}